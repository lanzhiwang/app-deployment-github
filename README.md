# 进度
- [ ] 公共服务
- [ ] 训推平台
- [ ] 应用开发平台
- [ ] 知识库
- [ ] 科研助手

# 服务部署的分层结构
应用的部署完成从最底层开始依赖机器硬件配置、驱动安装、容器软件、基础服务设施、应用服务和数据初始化。  
![应用部署过程](./images/private_release_1.png)

# 面向分层的发布方式
面向单一产品的打包方式无形中将关注内容限制在了当前产品中，导致部分工作内容为了当前业务进行了定制化操作，从而难以进行有效的拓展。同时，因为最终验收的产物是特定的产品功能，所以测试验证的也都是产品功能，中间过程的产物缺乏有效验证。而且上下游相互依赖，导致上游等待下游修复bug，下游等待上游修复bug，无法并线进行，最终周期很长。  

基于上节中的应用层次划分结构，我们借用软件设计中的分层思想来考虑私有化发版。

> "We can solve any problem by introducing an extra level of indirection."  
> 计算机科学中的所有问题都可以通过增加一个间接层来解决。

分层设计的思想贯穿于软件设计的方方面面，IAAS、PAAS、SAAS，视图层、业务逻辑层、数据访问层，代表OSI七层网络模型的HTTP协议，等等。采用分层构建的方式的核心原则是高内聚、低耦合，需要注意几点：
- 明确各个层次的功能边界
- 保证单向依赖，避免反向依赖和循环依赖
- 层的内聚性，职责单一
- 层次间接口的合理性
- 避免过度分层
- 可拓展性和可测试性

![分层设计](./images/private_release.png)
这里以三层为例，
- 应用层：包括业务服务和公共服务
- 中间件层：包括数据库、缓存、消息队列等中间件
- 基础环境层：包括操作系统、驱动和k8s基础环境

本仓库包含应用层的部署文件和初始化脚本。

部署文件包括：(采用 base + overlays 的形式，利用 [kustomize 工具](https://github.com/kubernetes-sigs/kustomize))
- deployment YAML文件
- service YAML文件
- istio YAML文件
- configmap YAML文件
- pv, pvc YAML文件

初始化脚本包括：
- job YAML文件
  - 模型数据下载脚本
  - 数据库初始化脚本
  - ES索引初始化脚本
- SQL文件